<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>ValueHub â€” Affordable Items</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
  <style>
    /* ---------- THEME / LAYOUT ---------- */
    :root{
      --blue-500:#1666f1;
      --teal-500:#0aa3a3;
      --blue-700:#0b4fcc;
      --muted:#6b7280;
      --card-bg:#ffffff;
      --page-bg:#f4f6fb;
      --radius:12px;
      --text:#0f172a;
    }
    [data-theme="dark"]{
      --card-bg:#0f1724;
      --page-bg:#071026;
      --muted:#93a4c7;
      --text:#e6eefc;
    }
    *{box-sizing:border-box}
    body{ font-family:Inter,system-ui,Arial; margin:0; background:var(--page-bg); color:var(--text); -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale; }

    header.nav { display:flex; align-items:center; justify-content:space-between; padding:14px 20px; gap:12px; }
    .brand { display:flex; gap:12px; align-items:center; }
    .logo { width:52px; height:52px; border-radius:10px; display:flex; align-items:center; justify-content:center; color:white; font-weight:700;
      background: linear-gradient(135deg,var(--blue-500),var(--teal-500)); box-shadow:0 8px 24px rgba(3,19,89,0.08);
    }
    .title { font-weight:700; }
    .subtitle { font-size:12px; color:var(--muted); }

    nav.controls { display:flex; gap:10px; align-items:center; }
    .icon-btn { background:transparent; border:1px solid rgba(0,0,0,0.06); padding:8px 10px; border-radius:10px; cursor:pointer; display:inline-flex; gap:8px; align-items:center; color:var(--text); }
    .cart-count { background:#ff6b6b; color:white; padding:2px 8px; border-radius:999px; font-weight:700; font-size:12px; }

    .wrap { max-width:1150px; margin:18px auto 40px; padding:0 20px; }
    .hero { padding:18px; border-radius:12px; background: linear-gradient(180deg, rgba(22,102,241,0.06), rgba(10,163,163,0.02)); margin-bottom:18px; }

    .grid { display:grid; grid-template-columns: repeat(auto-fit, minmax(240px,1fr)); gap:18px; }
    .card { background:var(--card-bg); border-radius:12px; padding:12px; display:flex; gap:10px; flex-direction:column; min-height:300px; box-shadow:0 10px 30px rgba(2,6,23,0.04); }
    .card img{ width:100%; height:180px; object-fit:cover; border-radius:8px; }
    .card h3{ margin:0; }
    .price{ font-weight:700; color:var(--blue-500); }
    .desc{ color:var(--muted); font-size:13px; min-height:40px; }

    .actions{ display:flex; gap:8px; margin-top:auto; }
    .btn{ background:var(--blue-500); color:white; border:none; padding:8px 12px; border-radius:10px; cursor:pointer; font-weight:600; }
    .btn.secondary{ background:transparent; color:var(--blue-700); border:1px solid rgba(13,76,204,0.08); }

    .checkout{ margin-top:18px; background:var(--card-bg); padding:16px; border-radius:12px; box-shadow:0 10px 30px rgba(2,6,23,0.04); }
    input[type="text"], textarea{ padding:10px; border-radius:10px; border:1px solid #e6eefc; width:100%; }

    /* cart panel */
    .cart-panel{ position:fixed; right:18px; top:84px; width:380px; max-width:92%; background:var(--card-bg); border-radius:12px; box-shadow:0 18px 50px rgba(2,6,23,0.16); padding:14px; z-index:90; display:none; }
    .cart-items{ max-height:320px; overflow:auto; display:flex; flex-direction:column; gap:12px; }

    /* modal */
    .modal-backdrop{ position:fixed; inset:0; display:none; align-items:center; justify-content:center; background:rgba(2,6,23,0.6); z-index:120; padding:16px; }
    .modal{ background:var(--card-bg); width:100%; max-width:900px; border-radius:12px; padding:18px; box-shadow:0 20px 60px rgba(2,6,23,0.3); max-height:90vh; overflow:auto; display:flex; gap:16px; flex-direction:column; }
    .modal img{ width:100%; max-width:440px; height:420px; object-fit:contain; border-radius:8px; background:#f6f9ff; }

    /* chat */
    .chat-btn{ position:fixed; left:18px; bottom:18px; z-index:110; background:linear-gradient(135deg,var(--blue-500),var(--blue-700)); color:white; padding:12px; border-radius:999px; border:none; cursor:pointer; box-shadow:0 10px 30px rgba(13,76,204,0.18); }
    .chat-panel{ position:fixed; left:18px; bottom:82px; width:360px; max-width:92%; z-index:110; display:none; background:var(--card-bg); border-radius:12px; box-shadow:0 18px 50px rgba(2,6,23,0.16); overflow:hidden; }
    .chat-header{ padding:12px; display:flex; justify-content:space-between; align-items:center; border-bottom:1px solid rgba(0,0,0,0.04); }
    .chat-messages{ max-height:340px; overflow:auto; padding:12px; display:flex; flex-direction:column; gap:10px; }
    .msg{ padding:10px 12px; border-radius:12px; max-width:76%; }
    .msg.user{ align-self:flex-end; background:linear-gradient(90deg,var(--blue-500),var(--blue-700)); color:white; }
    .msg.bot{ align-self:flex-start; background:rgba(0,0,0,0.04); color:var(--muted); }

    footer{ text-align:center; color:var(--muted); margin:30px 0 60px; display:flex; flex-direction:column; align-items:center; gap:8px; }
    .share-link{ display:flex; gap:8px; align-items:center; background:var(--card-bg); padding:8px 12px; border-radius:8px; }

    /* error banner */
    #errorBanner{ position:fixed; left:12px; right:12px; top:12px; background:#ffecec; color:#8b2222; border:1px solid #f5c6c6; padding:12px; border-radius:8px; z-index:999; display:none; }

    @media (max-width:720px){ .card img{ height:160px; } .modal img{ height:240px; } .cart-panel{ right:10px; left:10px; } }
  </style>
</head>
<body>
  <div id="errorBanner" role="alert"></div>

  <header class="nav">
    <div class="brand">
      <div class="logo" aria-hidden="true">
        <!-- Blue SVG logo -->
        <svg width="36" height="36" viewBox="0 0 64 64" xmlns="http://www.w3.org/2000/svg"><rect width="64" height="64" rx="12" fill="url(#g)"/><path d="M18 42 L26 24 L34 34 L46 18" stroke="white" stroke-width="3.5" stroke-linecap="round" stroke-linejoin="round"/><defs><linearGradient id="g" x1="0" y1="0" x2="1" y2="1"><stop offset="0" stop-color="#1666f1"/><stop offset="1" stop-color="#0aa3a3"/></linearGradient></defs></svg>
      </div>
      <div>
        <div class="title">ValueHub</div>
        <div class="subtitle">Affordable items â€¢ Pay On Pick Up</div>
      </div>
    </div>

    <nav class="controls" aria-label="Main controls">
      <button id="themeToggle" class="icon-btn" title="Toggle dark/light">ðŸŒ™</button>
      <button id="openCartBtn" class="icon-btn">Cart <span id="cartCount" class="cart-count">0</span></button>
      <button id="adminBtn" class="icon-btn">Admin</button>
    </nav>
  </header>

  <main class="wrap">
    <section class="hero">
      <div>
        <h1>ValueHub â€” Affordable Items for Everyone</h1>
        <p>Browse items, add to cart, and confirm via WhatsApp. Admins can add/remove items directly from this browser.</p>
      </div>
    </section>

    <section>
      <h2>Available Products</h2>
      <div id="productGrid" class="grid"></div>
    </section>

    <section id="checkoutSection" class="checkout">
      <h3>Checkout</h3>
      <div class="field"><label for="name">Your Name</label><input id="name" type="text" placeholder="e.g. Aisha"></div>
      <div class="field"><label for="phone">WhatsApp Number</label><input id="phone" type="text" placeholder="e.g. 08012345678"></div>
      <div class="field"><label>Your Order (auto-generated)</label><textarea id="orderBox" readonly placeholder="Add items to cart to build your order..."></textarea></div>
      <div style="display:flex; gap:10px;"><button id="sendWhatsBtn" class="btn">Send to WhatsApp</button><button id="clearCartBtn" class="btn secondary">Clear Cart</button></div>
      <p style="margin-top:10px; color:var(--muted); font-size:13px;">Click Send to WhatsApp to confirm; message includes "Pay On Pick Up".</p>
    </section>

    <!-- Admin panel (hidden) -->
    <section id="adminPanel" class="admin-panel" aria-hidden="true">
      <h4>Admin Dashboard</h4>
      <p style="color:var(--muted)">Password: <strong>ValueHub2025</strong>. Upload image from your device, set name, price, description. Data stored in this browser's localStorage.</p>
      <div class="admin-grid">
        <input id="adminImageFile" type="file" accept="image/*">
        <input id="adminName" placeholder="Product name">
        <input id="adminPrice" placeholder="Price (numbers)">
        <input id="adminDesc" placeholder="Short description">
      </div>
      <div style="margin-top:8px; display:flex; gap:8px;">
        <button id="adminAddBtn" class="btn">Add Product</button>
        <button id="exportBtn" class="btn secondary">Export JSON</button>
        <button id="importBtn" class="btn secondary">Import JSON</button>
        <button id="logoutAdminBtn" class="btn secondary">Logout</button>
      </div>
    </section>

  </main>

  <!-- Cart panel -->
  <aside id="cartPanel" class="cart-panel" aria-hidden="true">
    <h4>Your Cart</h4>
    <div id="cartItems" class="cart-items"></div>
    <div class="cart-footer" style="display:flex; justify-content:space-between; align-items:center;">
      <div>Total: <span id="cartTotal">â‚¦0</span></div>
      <div style="display:flex; gap:8px;"><button id="closeCartBtn" class="btn secondary">Close</button><button id="goCheckoutBtn" class="btn">Checkout</button></div>
    </div>
  </aside>

  <!-- product modal -->
  <div id="modalBackdrop" class="modal-backdrop" aria-hidden="true">
    <div class="modal" role="dialog" aria-modal="true">
      <div style="display:flex; justify-content:space-between; align-items:center;">
        <h3 id="modalTitle" style="margin:0"></h3>
        <div><button id="closeModalBtn" class="btn secondary">Close</button></div>
      </div>
      <div style="display:flex; gap:16px; flex-wrap:wrap; margin-top:8px;">
        <img id="modalImage" src="" alt="Product image">
        <div style="flex:1;">
          <div id="modalDesc" class="desc"></div>
          <div id="modalPrice" style="margin-top:12px; font-size:18px;"></div>
        </div>
      </div>
    </div>
  </div>

  <!-- chat -->
  <button id="chatToggle" class="chat-btn">Chat AI</button>
  <div id="chatPanel" class="chat-panel" aria-hidden="true">
    <div class="chat-header">
      <div><strong>ValueHub AI</strong><div style="font-size:12px;color:var(--muted)">Ask about app, products, pickup, payments</div></div>
      <div><button id="closeChatBtn" class="btn small">Close</button></div>
    </div>
    <div id="chatMessages" class="chat-messages"></div>
    <div style="display:flex; gap:8px; padding:10px; border-top:1px solid rgba(0,0,0,0.04);">
      <input id="chatInput" type="text" placeholder="Ask a question..." style="flex:1; padding:8px 10px; border-radius:8px;">
      <button id="chatSendBtn" class="btn small">Send</button>
    </div>
  </div>

  <footer>
    <div class="share-link">
      <div style="font-weight:600">Share ValueHub:</div>
      <input id="shareLink" value="https://itzceo.github.io/ValueHub/" readonly style="border:0; background:transparent; font-weight:600; color:var(--blue-700)"/>
      <button id="copyShareBtn" class="btn small">Copy</button>
    </div>
    <div style="color:var(--muted)">Â© <span id="year"></span> ValueHub â€” Enquiries: +234 901 003 4530</div>
  </footer>

<script>
/* ------------------------------
   Stable single-file implementation
   ------------------------------ */

/* Config */
const ADMIN_PASSWORD = "ValueHub2025";
const WHATSAPP_NUMBER = "2349010034530";
const PRODUCTS_KEY = "valuehub_products_final_v2";
const CART_KEY = "valuehub_cart_final_v2";
const ADMIN_FLAG = "valuehub_admin_final_v2";
const THEME_KEY = "valuehub_theme_final_v2";

/* Utilities */
function uid(){ return 'p_' + Math.random().toString(36).slice(2,9); }
function escapeHtml(s){ if(!s) return ''; return String(s).replace(/[&<>"']/g, m=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m])); }
function formatPrice(n){ return "â‚¦" + Number(n||0).toLocaleString(); }
function showError(text){ const b = document.getElementById('errorBanner'); b.innerText = "JS ERROR: " + text; b.style.display = 'block'; setTimeout(()=>b.style.display='none', 15000); }

/* basic error trap - will display on page when uncaught errors happen */
window.addEventListener('error', function(ev){
  try{ const msg = (ev && ev.message) ? ev.message : String(ev); showError(msg); }catch(e){}
});

/* Seed products (SVG placeholders stored as data URLs) */
const seedProducts = [
  { id: uid(), name: "Power Bank", price:3500, image: "data:image/svg+xml;utf8," + encodeURIComponent(`<svg xmlns='http://www.w3.org/2000/svg' width='800' height='600'><rect width='100%' height='100%' fill='#eef6ff'/><text x='50%' y='50%' dominant-baseline='middle' text-anchor='middle' font-size='36' fill='#1666f1'>Power Bank</text></svg>`), desc: "Power Bank â€¢ 10000mAh â€¢ Good condition" },
  { id: uid(), name: "Shirt", price:1500, image: "data:image/svg+xml;utf8," + encodeURIComponent(`<svg xmlns='http://www.w3.org/2000/svg' width='800' height='600'><rect width='100%' height='100%' fill='#f5fff9'/><text x='50%' y='50%' dominant-baseline='middle' text-anchor='middle' font-size='36' fill='#0aa3a3'>Shirt</text></svg>`), desc: "Good condition men's shirt" },
  { id: uid(), name: "Kettle", price:2000, image: "data:image/svg+xml;utf8," + encodeURIComponent(`<svg xmlns='http://www.w3.org/2000/svg' width='800' height='600'><rect width='100%' height='100%' fill='#fff7ee'/><text x='50%' y='50%' dominant-baseline='middle' text-anchor='middle' font-size='36' fill='#0b4fcc'>Kettle</text></svg>`), desc: "Small electric kettle, works fine" },
  { id: uid(), name: "School Bag", price:1200, image: "data:image/svg+xml;utf8," + encodeURIComponent(`<svg xmlns='http://www.w3.org/2000/svg' width='800' height='600'><rect width='100%' height='100%' fill='#fff7ff'/><text x='50%' y='50%' dominant-baseline='middle' text-anchor='middle' font-size='36' fill='#6b7280'>School Bag</text></svg>`), desc: "Durable school bag" }
];

/* load/save helpers */
function loadProducts(){ try{ const raw = localStorage.getItem(PRODUCTS_KEY); if(!raw){ localStorage.setItem(PRODUCTS_KEY, JSON.stringify(seedProducts)); return seedProducts.slice(); } return JSON.parse(raw); } catch(e){ localStorage.removeItem(PRODUCTS_KEY); localStorage.setItem(PRODUCTS_KEY, JSON.stringify(seedProducts)); return seedProducts.slice(); } }
function saveProducts(arr){ localStorage.setItem(PRODUCTS_KEY, JSON.stringify(arr)); }
function loadCart(){ try{ return JSON.parse(localStorage.getItem(CART_KEY) || "[]"); }catch(e){ localStorage.removeItem(CART_KEY); return []; } }
function saveCart(c){ localStorage.setItem(CART_KEY, JSON.stringify(c)); }

/* theme */
function applyTheme(theme){ try{ if(theme === 'dark') document.documentElement.setAttribute('data-theme','dark'); else document.documentElement.removeAttribute('data-theme'); localStorage.setItem(THEME_KEY, theme); document.getElementById('themeToggle').textContent = (theme==='dark') ? 'â˜€ï¸' : 'ðŸŒ™'; }catch(e){ showError(e.message || e); } }

/* app state */
let products = [];
let cart = [];

/* initialize after DOM ready */
window.addEventListener('DOMContentLoaded', function(){
  try{
    /* wire UI elements */
    const productGrid = document.getElementById('productGrid');
    const cartPanel = document.getElementById('cartPanel');
    const cartItemsEl = document.getElementById('cartItems');
    const cartCountEl = document.getElementById('cartCount');
    const cartTotalEl = document.getElementById('cartTotal');
    const modalBackdrop = document.getElementById('modalBackdrop');
    const modalTitle = document.getElementById('modalTitle');
    const modalImage = document.getElementById('modalImage');
    const modalDesc = document.getElementById('modalDesc');
    const modalPrice = document.getElementById('modalPrice');

    const themeToggle = document.getElementById('themeToggle');
    const openCartBtn = document.getElementById('openCartBtn');
    const closeCartBtn = document.getElementById('closeCartBtn');
    const goCheckoutBtn = document.getElementById('goCheckoutBtn');
    const sendWhatsBtn = document.getElementById('sendWhatsBtn');
    const clearCartBtn = document.getElementById('clearCartBtn');
    const adminBtn = document.getElementById('adminBtn');
    const adminPanel = document.getElementById('adminPanel');
    const adminImageFile = document.getElementById('adminImageFile');
    const adminAddBtn = document.getElementById('adminAddBtn');
    const exportBtn = document.getElementById('exportBtn');
    const importBtn = document.getElementById('importBtn');
    const logoutAdminBtn = document.getElementById('logoutAdminBtn');
    const nameInput = document.getElementById('name');
    const phoneInput = document.getElementById('phone');
    const orderBox = document.getElementById('orderBox');

    const chatToggle = document.getElementById('chatToggle');
    const chatPanel = document.getElementById('chatPanel');
    const chatMessages = document.getElementById('chatMessages');
    const chatInput = document.getElementById('chatInput');
    const chatSendBtn = document.getElementById('chatSendBtn');
    const closeChatBtn = document.getElementById('closeChatBtn');

    const shareInput = document.getElementById('shareLink');
    const copyShareBtn = document.getElementById('copyShareBtn');

    const closeModalBtn = document.getElementById('closeModalBtn');

    /* theme init */
    const savedTheme = localStorage.getItem(THEME_KEY) || 'light';
    applyTheme(savedTheme);

    /* load state */
    products = loadProducts();
    cart = loadCart();

    /* RENDER PRODUCTS (no inline onclicks) */
    function renderProducts(){
      productGrid.innerHTML = '';
      products.forEach(prod=>{
        const card = document.createElement('div'); card.className = 'card';
        // image
        const img = document.createElement('img'); img.src = prod.image || ''; img.alt = prod.name;
        img.onerror = function(){ this.onerror=null; this.src = 'data:image/svg+xml;utf8,' + encodeURIComponent(`<svg xmlns='http://www.w3.org/2000/svg' width='600' height='400'><rect width='100%' height='100%' fill='#f0f4ff'/><text x='50%' y='50%' dominant-baseline='middle' text-anchor='middle' fill='#1666f1' font-size='28'>No image</text></svg>`); };
        const h3 = document.createElement('h3'); h3.textContent = prod.name;
        const priceDiv = document.createElement('div'); priceDiv.className = 'price'; priceDiv.textContent = formatPrice(prod.price);
        const descDiv = document.createElement('div'); descDiv.className = 'desc'; descDiv.textContent = prod.desc || '';
        const actions = document.createElement('div'); actions.className = 'actions';

        const addBtn = document.createElement('button'); addBtn.className = 'btn'; addBtn.textContent = 'Add to Cart';
        addBtn.addEventListener('click', ()=>{ addToCart(prod.id); });

        const viewBtn = document.createElement('button'); viewBtn.className = 'btn secondary'; viewBtn.textContent = 'View';
        viewBtn.addEventListener('click', ()=>{ openModal(prod.id); });

        actions.appendChild(addBtn); actions.appendChild(viewBtn);

        if(localStorage.getItem(ADMIN_FLAG)){
          const remBtn = document.createElement('button'); remBtn.className = 'btn ghost'; remBtn.style.color='#b03030'; remBtn.textContent = 'Remove';
          remBtn.addEventListener('click', ()=>{ if(confirm('Remove this product?')){ products = products.filter(p=>p.id!==prod.id); saveProducts(products); renderProducts(); }});
          actions.appendChild(remBtn);
        }

        card.appendChild(img); card.appendChild(h3); card.appendChild(priceDiv); card.appendChild(descDiv); card.appendChild(actions);
        productGrid.appendChild(card);
      });
    }

    /* CART functions */
    function saveAndRenderCart(){ saveCart(cart); renderCart(); }
    function addToCart(productId){
      const p = products.find(x=>x.id===productId); if(!p) return alert('Product not found');
      const existing = cart.find(c=>c.id===productId);
      if(existing) existing.qty++;
      else cart.push({ id:p.id, name:p.name, price:p.price, image:p.image, qty:1 });
      saveAndRenderCart(); flashCart();
    }
    function changeQty(productId, delta){
      const idx = cart.findIndex(c=>c.id===productId); if(idx===-1) return;
      cart[idx].qty = Math.max(1, cart[idx].qty + delta); saveAndRenderCart();
    }
    function removeFromCart(productId){ cart = cart.filter(c=>c.id!==productId); saveAndRenderCart(); }
    function computeTotal(){ return cart.reduce((s,i)=> s + (Number(i.price||0) * Number(i.qty||0)), 0); }

    function renderCart(){
      cartItemsEl.innerHTML = '';
      if(cart.length === 0){ cartItemsEl.innerHTML = '<div style="color:var(--muted)">Cart is empty.</div>'; }
      cart.forEach(it=>{
        const row = document.createElement('div'); row.className = 'cart-item'; row.style.display='flex'; row.style.justifyContent='space-between'; row.style.alignItems='center';
        const left = document.createElement('div'); left.style.display='flex'; left.style.gap='8px'; left.style.alignItems='center';
        const img = document.createElement('img'); img.src = it.image; img.style.width='72px'; img.style.height='56px'; img.style.objectFit='cover'; img.style.borderRadius='8px';
        const meta = document.createElement('div'); meta.innerHTML = `<b>${escapeHtml(it.name)}</b><div style="font-size:13px;color:var(--muted)">${formatPrice(it.price)} â€¢ ${it.qty} pcs</div>`;
        left.appendChild(img); left.appendChild(meta);
        const controls = document.createElement('div'); controls.style.display='flex'; controls.style.flexDirection='column'; controls.style.gap='8px'; controls.style.alignItems='flex-end';
        const qtyControls = document.createElement('div'); qtyControls.style.display='flex'; qtyControls.style.gap='6px';
        const minus = document.createElement('button'); minus.className='small-btn'; minus.textContent='â€“'; minus.addEventListener('click', ()=>changeQty(it.id, -1));
        const qtyBox = document.createElement('div'); qtyBox.style.padding='6px 8px'; qtyBox.style.borderRadius='6px'; qtyBox.style.border='1px solid #eef2f7'; qtyBox.textContent = it.qty;
        const plus = document.createElement('button'); plus.className='small-btn'; plus.textContent='+'; plus.addEventListener('click', ()=>changeQty(it.id, 1));
        qtyControls.appendChild(minus); qtyControls.appendChild(qtyBox); qtyControls.appendChild(plus);
        const removeBtn = document.createElement('button'); removeBtn.className='small-btn'; removeBtn.textContent='Remove'; removeBtn.style.background='#ffecec'; removeBtn.style.color='#ba2d2d';
        removeBtn.addEventListener('click', ()=>removeFromCart(it.id));
        controls.appendChild(qtyControls); controls.appendChild(removeBtn);
        row.appendChild(left); row.appendChild(controls);
        cartItemsEl.appendChild(row);
      });
      cartTotalEl.textContent = formatPrice(computeTotal());
      cartCountEl.textContent = cart.reduce((s,i)=>s + (i.qty||0), 0);
      // orderBox update
      orderBox.value = cart.length ? cart.map(i=> `${i.name} x${i.qty} (${formatPrice(i.price)})`).join(", ") : '';
    }

    /* Modal */
    function openModal(id){
      const p = products.find(x=>x.id===id); if(!p) return;
      modalTitle.textContent = p.name; modalImage.src = p.image; modalDesc.textContent = p.desc || ''; modalPrice.textContent = formatPrice(p.price);
      modalBackdrop.style.display = 'flex'; modalBackdrop.setAttribute('aria-hidden','false');
    }
    function closeModal(){ modalBackdrop.style.display = 'none'; modalBackdrop.setAttribute('aria-hidden','true'); }

    /* Admin: image upload to base64 */
    adminImageFile.addEventListener('change', function(e){
      const f = e.target.files[0]; if(!f) return;
      const reader = new FileReader();
      reader.onload = function(ev){ adminImageFile.dataset.base64 = ev.target.result; };
      reader.readAsDataURL(f);
    });

    function adminAddProduct(){
      const name = document.getElementById('adminName').value.trim();
      const priceRaw = document.getElementById('adminPrice').value.trim();
      const desc = document.getElementById('adminDesc').value.trim();
      const base64 = adminImageFile.dataset.base64;
      if(!name || !priceRaw) return alert('Please provide name and price.');
      const price = Number(priceRaw.replace(/[^0-9.-]+/g,'')); if(isNaN(price) || price <= 0) return alert('Provide valid price.');
      const image = base64 || ("data:image/svg+xml;utf8," + encodeURIComponent(`<svg xmlns='http://www.w3.org/2000/svg' width='800' height='600'><rect width='100%' height='100%' fill='#eef6ff'/><text x='50%' y='50%' dominant-baseline='middle' text-anchor='middle' font-size='36' fill='#1666f1'>${escapeHtml(name)}</text></svg>`));
      const prod = { id: uid(), name, price, image, desc };
      products.unshift(prod); saveProducts(products); renderProducts();
      // reset
      document.getElementById('adminName').value=''; document.getElementById('adminPrice').value=''; document.getElementById('adminDesc').value=''; adminImageFile.value=''; delete adminImageFile.dataset.base64;
      alert('Product added (saved in this browser).');
    }

    function exportProducts(){ try{ const data = JSON.stringify(products, null, 2); const blob = new Blob([data], {type:'application/json'}); const url = URL.createObjectURL(blob); const a = document.createElement('a'); a.href=url; a.download='valuehub_products.json'; a.click(); URL.revokeObjectURL(url); }catch(e){ showError(e.message||e); } }
    function importProductsPrompt(){ const json = prompt('Paste product JSON (array) to replace current list:'); if(!json) return; try{ const arr = JSON.parse(json); if(!Array.isArray(arr)) throw new Error('Expecting array'); arr.forEach(it=>{ if(!it.id) it.id=uid(); if(!it.name) it.name='Unnamed'; if(!it.price) it.price=0; }); products = arr; saveProducts(products); renderProducts(); alert('Imported.'); }catch(e){ alert('Import failed: ' + e.message); } }

    /* Checkout -> WhatsApp */
    function checkout(){
      const name = nameInput.value.trim(); const phone = phoneInput.value.trim();
      if(!name || !phone) return alert('Enter name and WhatsApp number before checkout.');
      if(cart.length === 0) return alert('Cart is empty.');
      const items = cart.map(i=> `${i.name} x${i.qty} (${formatPrice(i.price)})`).join(", ");
      const total = formatPrice(computeTotal());
      const message = `Hello ValueHub,\nName: ${name}\nPhone: ${phone}\nOrder: ${items}\nTotal: ${total}\nPay On Pick Up`;
      const url = `https://wa.me/${WHATSAPP_NUMBER}?text=${encodeURIComponent(message)}`;
      window.open(url, '_blank');
    }

    /* Chat - Option A knowledge base + product-aware answers */
    const faqKB = [
      { q: /how do i pay|how to pay|payment|pay/i, a: "Payment is Pay On Pick Up â€” you place an order and confirm via WhatsApp; then you'll pay in cash or transfer when you collect your items." },
      { q: /pickup|where do i pick|pick up|collect/i, a: "After you place an order and confirm, ValueHub will send pickup instructions and exact location on WhatsApp." },
      { q: /delivery|do you deliver|shipping/i, a: "We currently support Pay On Pick Up only. Delivery is not available yet." },
      { q: /price|cost|how much/i, a: "Each product's price is displayed under its picture. Ask me about a product name for direct price & availability." },
      { q: /add product|sell item|donate/i, a: "Only admins can add products. If you want to donate items, message our WhatsApp to arrange it." },
      { q: /refund|return|exchange/i, a: "Return/exchange accepted within 3 days if item condition differs from description. Contact ValueHub on WhatsApp to arrange." },
      { q: /how to use|how do i use the site|how it works/i, a: "Browse items, add to cart, enter your name & WhatsApp number, click Send to WhatsApp to confirm. Pay On Pick Up when you collect." },
      { q: /contact|support|help/i, a: "Contact ValueHub on WhatsApp: +234 901 003 4530." }
    ];

    function sendChatMessage(){
      const text = chatInput.value.trim(); if(!text) return;
      appendChat('user', text); chatInput.value = '';
      const lowered = text.toLowerCase();
      const matchedProduct = products.find(p => lowered.includes(p.name.toLowerCase()));
      if(matchedProduct){ setTimeout(()=> appendChat('bot', `${matchedProduct.name} â€” ${formatPrice(matchedProduct.price)}. ${matchedProduct.desc || ''} To buy: add to cart and proceed to checkout.`), 250); return; }
      for(const item of faqKB){ if(item.q.test(text)){ setTimeout(()=> appendChat('bot', item.a), 250); return; } }
      setTimeout(()=> appendChat('bot', "Sorry, I don't have an exact answer right now. Try asking about products, prices, checkout, or pickup. Or message us on WhatsApp: +234 901 003 4530."), 350);
    }
    function appendChat(who, text){ const d = document.createElement('div'); d.className = 'msg ' + (who==='user' ? 'user' : 'bot'); d.innerText = text; chatMessages.appendChild(d); chatMessages.scrollTop = chatMessages.scrollHeight; }

    /* copy share link */
    copyShareBtn.addEventListener('click', async ()=>{
      try{
        if(navigator.clipboard && navigator.clipboard.writeText){ await navigator.clipboard.writeText(shareInput.value); alert('Share link copied: ' + shareInput.value); }
        else { shareInput.select(); document.execCommand('copy'); alert('Share link copied: ' + shareInput.value); }
      }catch(e){ showError('Copy failed: ' + (e.message||e)); }
    });

    /* attach UI listeners */
    themeToggle.addEventListener('click', ()=>{ const cur = localStorage.getItem(THEME_KEY) || 'light'; applyTheme(cur==='dark' ? 'light' : 'dark'); });
    openCartBtn.addEventListener('click', ()=>{ cartPanel.style.display = (cartPanel.style.display==='block') ? 'none' : 'block'; renderCart(); });
    closeCartBtn.addEventListener('click', ()=>{ cartPanel.style.display = 'none'; });
    goCheckoutBtn.addEventListener('click', ()=>{ cartPanel.style.display='none'; document.getElementById('checkoutSection').scrollIntoView({behavior:'smooth'}); });
    sendWhatsBtn.addEventListener('click', checkout);
    clearCartBtn.addEventListener('click', ()=>{ if(confirm('Clear cart?')){ cart = []; saveCart(cart); renderCart(); }});
    adminBtn.addEventListener('click', ()=>{ const pwd = prompt('Enter admin password:'); if(pwd === null) return; if(pwd === ADMIN_PASSWORD){ localStorage.setItem(ADMIN_FLAG,'1'); adminPanel.style.display='block'; renderProducts(); alert('Admin unlocked'); } else alert('Incorrect password'); });
    adminAddBtn.addEventListener('click', adminAddProduct);
    exportBtn.addEventListener('click', exportProducts);
    importBtn.addEventListener('click', importProductsPrompt);
    logoutAdminBtn.addEventListener('click', ()=>{ localStorage.removeItem(ADMIN_FLAG); adminPanel.style.display='none'; renderProducts(); alert('Logged out admin'); });

    /* modal */
    closeModalBtn.addEventListener('click', closeModal);
    modalBackdrop.addEventListener('click', function(e){ if(e.target === modalBackdrop) closeModal(); });

    /* chat */
    chatToggle.addEventListener('click', ()=>{ chatPanel.style.display='block'; chatToggle.style.display='none'; chatInput.focus(); });
    closeChatBtn.addEventListener('click', ()=>{ chatPanel.style.display='none'; chatToggle.style.display='block'; });
    chatSendBtn.addEventListener('click', sendChatMessage);
    chatInput.addEventListener('keydown', (e)=>{ if(e.key === 'Enter') sendChatMessage(); });

    /* admin product add binding function declared earlier (adminAddProduct) */
    async function adminAddProduct(){ adminAddProduct_helper(); } // placeholder replaced below

    /* small visual pulse for cart count */
    function flashCart(){ cartCountEl.style.transform='scale(1.12)'; setTimeout(()=>cartCountEl.style.transform='scale(1)',200); }

    /* actual logic functions (declared as closures so they're available) */
    function adminAddProduct_helper(){
      try{
        const name = document.getElementById('adminName').value.trim();
        const priceRaw = document.getElementById('adminPrice').value.trim();
        const desc = document.getElementById('adminDesc').value.trim();
        const base64 = adminImageFile.dataset.base64;
        if(!name || !priceRaw){ alert('Provide name and price'); return; }
        const price = Number(priceRaw.replace(/[^0-9.-]+/g,'')); if(isNaN(price) || price <= 0){ alert('Provide valid price'); return; }
        const image = base64 || ("data:image/svg+xml;utf8," + encodeURIComponent(`<svg xmlns='http://www.w3.org/2000/svg' width='800' height='600'><rect width='100%' height='100%' fill='#eef6ff'/><text x='50%' y='50%' dominant-baseline='middle' text-anchor='middle' font-size='36' fill='#1666f1'>${escapeHtml(name)}</text></svg>`));
        const prod = { id: uid(), name, price, image, desc };
        products.unshift(prod); saveProducts(products); renderProducts();
        document.getElementById('adminName').value=''; document.getElementById('adminPrice').value=''; document.getElementById('adminDesc').value=''; adminImageFile.value=''; delete adminImageFile.dataset.base64;
        alert('Product added (saved in this browser).');
      }catch(e){ showError(e.message || e); }
    }

    // expose adminAddProduct properly
    window.adminAddProduct = adminAddProduct_helper;

    // render initial state
    if(localStorage.getItem(ADMIN_FLAG)) adminPanel.style.display='block';
    renderProducts(); renderCart();

    // attach adminAdd button to helper
    document.getElementById('adminAddBtn').addEventListener('click', adminAddProduct_helper);

  }catch(err){
    // show error on page (visible) + console
    console.error(err);
    const banner = document.getElementById('errorBanner'); banner.innerText = 'Init failed: ' + (err.message || String(err)); banner.style.display = 'block';
  }
});

/* expose minimal functions used in earlier code or bookmarks */
function renderProducts(){ /* placeholder to avoid uncaught if called externally */ try{ /* nothing */ }catch(e){} }
function renderCart(){ try{}catch(e){} }

/* ensure year in footer */
document.getElementById('year').innerText = new Date().getFullYear();
</script>
</body>
</html>
